<!DOCTYPE html>
<html>
<head>
  <title>Host Game – Flashback</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
</head>
<body>
  <h1>Flashback – Host Panel (Game {{ game_id }})</h1>
  <p><strong>Time Left:</strong> <span id="timer">--</span> seconds</p>

  <div id="question-area">
    <h2 id="question-text">Waiting...</h2>
    <p><strong>Correct Answer:</strong> <span id="correct-answer"></span></p>
  </div>

  <div>
    <h3>Incoming Answers:</h3>
    <ul id="answer-list"></ul>
  </div>

  <button onclick="nextQuestion()">Next Question</button>
  <button onclick="endGame()">End Game</button>

  <script>
    const socket = io();
    const gameId = "{{ game_id }}";

    socket.emit("join_room", { game_id: gameId });

    socket.on("incoming_answer", function(data) {
      const li = document.createElement("li");
      li.innerHTML = `${data.team}: ${data.answer} 
        <button onclick="markCorrect('${data.team}')">✅</button>`;
      document.getElementById("answer-list").appendChild(li);
    });

    function markCorrect(team) {
      socket.emit("mark_correct", { game_id: gameId, team: team });
    }

    function nextQuestion() {
      socket.emit("next_question", { game_id: gameId });
      document.getElementById("answer-list").innerHTML = "";
    }

    function endGame() {
      socket.emit("end_game", { game_id: gameId });
      window.location.href = `/results/${gameId}`;
    }

    socket.on("next_question", (data) => {
      document.getElementById("question-text").textContent = data.question;
      document.getElementById("correct-answer").textContent = data.answer;
    });

    // === Timer Countdown Logic ===
    let countdownInterval;

  socket.on("start_timer", (data) => {
    console.log("[start_timer] received:", data);
    clearInterval(countdownInterval);
    const duration = (data && typeof data.duration === "number") ? data.duration : 30;
    let timeLeft = duration;
    document.getElementById("timer").textContent = timeLeft;

    countdownInterval = setInterval(() => {
      timeLeft--;
      document.getElementById("timer").textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(countdownInterval);
        // If you want the host to be the single source of truth when time ends:
        // socket.emit("timer_ended", { game_id: gameId });
      }
    }, 1000);
  });
</script>
  </script>
</body>
</html>
